<!--╔══════════════════════════════════════════════════════════════════════════════════════════╗
    ║                                Name: buttonGenerator                                     ║
    ║                                Author: Carson Morris                                     ║
    ║                                   Date: 11/12/2024                                       ║
    ║                                      Rev: 2.0                                            ║
    ╚══════════════════════════════════════════════════════════════════════════════════════════╝-->

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Custom Button Generator</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
        
        <!-- Base Styles -->
        <style>
            /* Reset and Base Styles */
            * {
                box-sizing: border-box;
                margin: 0;
                padding: 0;
            }
            body {
                font-family: 'Arial', sans-serif;
                background: linear-gradient(135deg, #1e3c72, #2a5298, #2980b9, #6dd5ed);
                color: #ecf0f1;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 50px 20px;
                animation: fadeIn 1.5s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            /* Header */
            header {
                background: linear-gradient(145deg, #34495e, #2c3e50);
                color: #f1c40f;
                padding: 20px 30px;
                text-align: center;
                flex: 0 0 auto;
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
                position: relative;
                border-radius: 12px;
                width: 100%;
                max-width: 1200px;
            }
            header h1 {
                font-size: 3rem;
                color: #f39c12;
                text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            }
            /* Credit Text */
            .credit {
                position: absolute;
                bottom: 10px;
                right: 20px;
                font-size: 14px;
                color: rgba(255, 255, 255, 0.8);
                font-style: italic;
            }
            /* Main content */
            main {
                flex: 1 1 auto;
                display: flex;
                width: 100%;
                max-width: 1200px;
                gap: 30px;
                margin-top: 30px;
                min-height: 0;
            }
            /* Sidebar Controls */
            #controls {
                width: 40%;
                background: linear-gradient(145deg, #34495e, #2c3e50);
                color: #ecf0f1;
                padding: 30px;
                overflow-y: auto;
                border-right: 1px solid #2c3e50;
                display: flex;
                flex-direction: column;
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                max-height: 80vh;
                position: relative;
            }
            /* Tab Navigation */
            .tab-navigation {
                display: flex;
                margin-bottom: 20px;
                position: sticky;
                top: 0;
                background: linear-gradient(145deg, #34495e, #2c3e50);
                z-index: 1;
                padding: 10px 0;
                border-bottom: 1px solid #2c3e50;
            }
            .tab-navigation button {
                flex: 1;
                padding: 15px;
                cursor: pointer;
                background-color: #2c3e50;
                color: #ecf0f1;
                border: none;
                outline: none;
                transition: background-color 0.3s, color 0.3s;
                font-weight: bold;
                border-radius: 8px;
                margin: 0 5px;
            }
            .tab-navigation button.active {
                background-color: #f1c40f;
                color: #34495e;
            }
            .tab-navigation button:hover {
                background-color: #1abc9c;
                color: #ffffff;
            }
            /* Sections */
            .section {
                display: none;
            }
            .section.active {
                display: block;
            }
            .section h2 {
                font-size: 1.8rem;
                margin-bottom: 15px;
                border-bottom: 1px solid #bdc3c7;
                padding-bottom: 5px;
                text-transform: uppercase;
                text-align: center;
                color: #f1c40f;
            }
            /* Subsections */
            .subsection {
                margin-bottom: 20px;
            }
            .subsection h3 {
                font-size: 1.6rem;
                margin-bottom: 10px;
                text-transform: uppercase;
                border-bottom: 1px dashed #bdc3c7;
                padding-bottom: 5px;
                display: flex;
                align-items: center;
                justify-content: space-between;
                color: #f1c40f;
            }
            /* Form Layout */
            .form-group {
                display: flex;
                flex-wrap: wrap;
                margin-bottom: 20px;
                align-items: flex-start;
                justify-content: flex-start;
            }
            .form-group label {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                margin-right: 20px;
                margin-bottom: 10px;
                width: calc(100% / 3 - 20px);
                color: #ecf0f1;
            }
            .form-group.three-items label {
                width: calc(100% / 3 - 20px);
            }
            .form-group.two-items label {
                width: calc(100% / 2 - 20px);
            }
            .form-group.four-items label {
                width: calc(100% / 4 - 20px);
            }
            .form-group.label-full-width {
                width: 100%;
                align-items: flex-start;
            }
            /* Center "Background Style" Title and Dropdown */
            #backgroundStyleContainer {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
            }
            #backgroundStyleContainer label {
                width: 100%;
                align-items: center;
            }
            /* Styled Color Inputs as Circles with Light Border */
            .color-input-wrapper {
                position: relative;
                width: 40px;
                height: 40px;
                border: 1px solid #ecf0f1;
                border-radius: 50%;
                overflow: hidden;
                margin-top: 5px;
            }
            .color-input-wrapper input[type="color"] {
                width: 100%;
                height: 100%;
                border: none;
                padding: 0;
                cursor: pointer;
                border-radius: 50%;
                appearance: none;
                background: none;
            }
            /* Remove default appearance */
            .color-input-wrapper input[type="color"]::-webkit-color-swatch-wrapper {
                padding: 0;
            }
            .color-input-wrapper input[type="color"]::-webkit-color-swatch {
                border: none;
                border-radius: 50%;
            }
            .color-input-wrapper input[type="color"]::-moz-color-swatch {
                border: none;
                border-radius: 50%;
            }
            input[type="color"] {
                --webkit-color-swatch: none;
            }
            /* Styled Checkboxes */
            .styled-checkbox {
                display: flex;
                align-items: center;
                margin-top: 5px;
            }
            .styled-checkbox input[type="checkbox"] {
                width: 18px;
                height: 18px;
                margin-right: 5px;
                cursor: pointer;
                accent-color: #f1c40f;
            }
            /* Dropdown for Fonts */
            .font-select-wrapper {
                position: relative;
                width: 100%;
            }
            .font-select-wrapper select {
                width: 100%;
                padding: 8px;
                border: 1px solid #1abc9c;
                border-radius: 6px;
                appearance: none;
                background-color: #34495e;
                color: #ecf0f1;
                background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="%23999"><polygon points="0,0 14,0 7,10" /></svg>');
                background-repeat: no-repeat;
                background-position: right 10px center;
                background-size: 12px;
                transition: border-color 0.3s, box-shadow 0.3s;
            }
            .font-select-wrapper select:focus {
                border-color: #f39c12;
                box-shadow: 0 0 5px #f39c12;
                outline: none;
            }
            .font-select-wrapper input[type="text"] {
                display: none;
                margin-top: 5px;
                padding: 8px;
                border: 1px solid #1abc9c;
                border-radius: 6px;
                background-color: #34495e;
                color: #ecf0f1;
                font-size: 16px;
                width: 100%;
            }
            /* Preview Area */
            #preview {
                width: 60%;
                background: linear-gradient(145deg, #34495e, #2c3e50);
                border-radius: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                color: #ecf0f1;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 30px;
                overflow-y: auto;
                max-height: 80vh;
            }
    
            #buttonContainer {
                width: 100%;
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                background-image: linear-gradient(45deg, #d8d8d8 25%, transparent 25%), 
                                    linear-gradient(-45deg, #d8d8d8 25%, transparent 25%), 
                                    linear-gradient(45deg, transparent 75%, #d8d8d8 75%), 
                                    linear-gradient(-45deg, transparent 75%, #d8d8d8 75%);
                background-size: 20px 20px;
                background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
                border: 2px solid #000000;
                border-radius: 12px;
                position: relative;
                padding: 20px;
                overflow: hidden;
            }
            
            /* Text Button */
            #textButton {
                font-size: 16px;
                font-family: 'Arial', sans-serif;
                color: #ffffff;
                background: linear-gradient(#4CAF50, #163C1D);
                border: 3px solid #000000;
                border-radius: 8px;
                padding: 10px 20px;
                box-shadow: 2px 2px 5px #000000;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            
            #textButton:hover {
                background: linear-gradient(#56d860, #1c4723);
                border-color: #333333;
            }
            
            #textButton:active {
                background: linear-gradient(#3a9f40, #122915);
                border-color: #222222;
            }
            
            /* Image Button */
            #imageButton {
                cursor: pointer;
                transition: all 0.3s ease;
                display: none;
                background-size: cover;
                background-repeat: no-repeat;
                background-position: center;
                border: none;
                min-width: 120px;
                min-height: 60px;
                background-color: transparent;
                padding: 0;
                position: relative;
                border-radius: 8px;
                box-shadow: none;
                overflow: visible;
            }
    
            #imageButtonImg {
                width: 100%;
                height: 100%;
                object-fit: cover;
                border-radius: 8px;
                background-color: transparent;
            }
            /* Image Text */
            .image-text {
                position: absolute;
                color: #ecf0f1;
                font-size: 18px;
                pointer-events: none;
                text-shadow:
                    -1px -1px 0 #000,
                    1px -1px 0 #000,
                    -1px 1px 0 #000,
                    1px 1px 0 #000;
                transition: all 0.3s ease;
                display: none;
                top: 50%;
                left: 50%;
                white-space: nowrap;
            }
            /* Download Buttons */
            #downloadButtons {
                width: 100%;
                display: flex;
                justify-content: center;
                gap: 10px;
                padding-top: 20px;
            }
            #downloadButtons button {
                padding: 15px 25px;
                cursor: pointer;
                border: none;
                background-color: #f1c40f;
                color: #34495e;
                border-radius: 8px;
                font-size: 18px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.2);
                transition: background-color 0.3s, box-shadow 0.3s;
            }
            #downloadButtons button:hover {
                background-color: #e67e22;
                box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            }
            /* Hide scrollbar for sidebar */
            #controls::-webkit-scrollbar {
                display: none;
            }
            #controls {
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            /* Responsive adjustments */
            @media (max-width: 800px) {
                main {
                    flex-direction: column;
                }
                #controls, #preview {
                    width: 100%;
                    max-height: none;
                    height: auto;
                }
                #buttonContainer {
                    height: auto;
                }
                .form-group label {
                    width: calc(100% / 2 - 20px);
                }
                .form-group.three-items label {
                    width: calc(100% / 2 - 20px);
                }
            }
            /* Enlarged Button Text Input */
            #buttonText, #imageButtonText {
                font-size: 16px;
                padding: 10px;
                height: 50px;
                width: 100%;
                border-radius: 6px;
                border: 1px solid #1abc9c;
                background-color: #34495e;
                color: #ecf0f1;
                transition: border-color 0.3s, box-shadow 0.3s;
            }
            /* Reduced Font Size Input */
            #fontSize, #imageResizePercentage, #imageWidth, #imageHeight {
                font-size: 16px;
                padding: 8px;
                height: 35px;
                width: 100%;
                border-radius: 6px;
                border: 1px solid #1abc9c;
                background-color: #34495e;
                color: #ecf0f1;
                transition: border-color 0.3s, box-shadow 0.3s;
            }
            /* Centered Labels */
            .form-group label > span {
                text-align: center;
                margin-bottom: 5px;
                font-weight: bold;
                color: #f1c40f;
            }
            /* Auto Buttons */
            .auto-button, .transform-button {
                padding: 10px 15px;
                font-size: 16px;
                cursor: pointer;
                background-color: #f1c40f;
                color: #34495e;
                border: none;
                border-radius: 8px;
                transition: background-color 0.3s, transform 0.2s;
                box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            }
            .auto-button:hover, .transform-button:hover {
                background-color: #e67e22;
                transform: translateY(-2px);
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            }
            /* Image Upload Section */
            .image-upload-section {
                margin-bottom: 20px;
                width: 100%;
            }
            .image-upload-section h2 {
                text-align: center;
                margin-bottom: 10px;
                color: #f1c40f;
            }
            .image-upload-section input[type="file"] {
                display: none;
            }
            .image-upload-label {
                display: block;
                width: 100%;
                padding: 20px 0;
                background-color: #3498db;
                color: #ecf0f1;
                border-radius: 8px;
                cursor: pointer;
                transition: background-color 0.3s, transform 0.2s;
                text-align: center;
                font-size: 20px;
                margin-bottom: 15px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            }
            .image-upload-label:hover {
                background-color: #1abc9c;
                transform: translateY(-2px);
                box-shadow: 0 6px 12px rgba(0,0,0,0.3);
            }
            /* Style for Range Inputs (Sliders) */
            input[type="range"] {
                width: 100%;
                margin-top: 5px;
                accent-color: #f1c40f;
            }
            /* Adjust Shadow Blur Entry Field */
            .shadow-blur-group {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
            }
            .shadow-blur-group label {
                width: 100%;
                text-align: center;
            }
        </style>
        
        <!-- SVG Filters for Pixelate and Noise Effects -->
        <svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="position: absolute; width: 0; height: 0;">
            <defs>
                <!-- Pixelate Filter -->
                <filter id="pixelateFilter">
                    <!-- Scale down the image -->
                    <feImage xlink:href="" result="sourceImage"/>
                    <feScale in="sourceImage" scale="0.1" result="scaledDown"/>
                    <!-- Scale up the image to create pixelation -->
                    <feScale in="scaledDown" scale="10" result="pixelated"/>
                    <!-- Overlay the pixelated image onto the original -->
                    <feComposite in="pixelated" in2="SourceGraphic" operator="over"/>
                </filter>

                <!-- Noise Filter -->
                <filter id="noiseFilter">
                    <feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="4" result="noise"/>
                    <feColorMatrix type="saturate" values="0" in="noise" result="monoNoise"/>
                    <feBlend in="SourceGraphic" in2="monoNoise" mode="multiply"/>
                </filter>
            </defs>
        </svg>

        <!-- Dynamic Styles -->
        <style id="dynamicStyles">
            /* Dynamic styles will be inserted here */
        </style>
    </head>
    
    <body>
        <header>
            <a href="../index.html" style="position: absolute; left: 30px; top: 50%; transform: translateY(-50%); text-decoration: none; color: #f1c40f; display: flex; align-items: center;">
                <i class="fas fa-home" style="font-size: 2rem;"></i>
            </a>        
            <h1>Custom Button Generator</h1>
            <!-- Added Credit Text -->
            <div class="credit">Created by: Carson Morris</div>
        </header>
        <main>
            <!-- Sidebar Controls -->
            <div id="controls">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button id="textTab" class="active">Text Button</button>
                    <button id="imageTab">Image Button</button>
                </div>
                <!-- Text Button Controls -->
                <div class="section active" id="textControls">
                    <h2>TEXT</h2>
                    <!-- Button Text -->
                    <div class="form-group">
                        <label for="buttonText" class="form-group label-full-width">
                            <span>Button Text:</span>
                            <input type="text" id="buttonText" value="Click Me">
                        </label>
                    </div>
                    <!-- Font Style, Font Size, Font Color -->
                    <div class="form-group three-items">
                        <label for="fontFamily">
                            <span>Font Style:</span>
                            <div class="font-select-wrapper">
                                <select id="fontFamily">
                                    <option value="'Arial', sans-serif">Arial</option>
                                    <option value="'Times New Roman', Times, serif">Times New Roman</option>
                                    <option value="'Courier New', Courier, monospace">Courier New</option>
                                    <option value="'Georgia', serif">Georgia</option>
                                    <option value="'Verdana', sans-serif">Verdana</option>
                                    <option value="'Palatino Linotype', 'Book Antiqua', Palatino, serif">Palatino</option>
                                    <option value="'Comic Sans MS', cursive, sans-serif">Comic Sans MS</option>
                                    <option value="'Impact', sans-serif">Impact</option>
                                    <option value="'Lucida Console', Monaco, monospace">Lucida Console</option>
                                    <option value="'Lucida Sans Unicode', 'Lucida Grande', sans-serif">Lucida Sans</option>
                                    <option value="'Tahoma', Geneva, sans-serif">Tahoma</option>
                                    <option value="'Trebuchet MS', Helvetica, sans-serif">Trebuchet MS</option>
                                    <option value="'Arial Black', Gadget, sans-serif">Arial Black</option>
                                    <option value="'Bookman Old Style', serif">Bookman Old Style</option>
                                    <option value="'Century Gothic', sans-serif">Century Gothic</option>
                                    <option value="'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif">Franklin Gothic Medium</option>
                                    <option value="'Gill Sans', sans-serif">Gill Sans</option>
                                    <option value="'Segoe UI', Tahoma, Geneva, Verdana, sans-serif">Segoe UI</option>
                                    <option value="'Roboto', sans-serif">Roboto</option>
                                    <option value="'Merriweather', serif">Merriweather</option>
                                    <option value="'Bebas Neue', cursive">Bebas Neue</option>
                                    <option value="'Inconsolata', monospace">Inconsolata</option>
                                    <option value="'Lora', serif">Lora</option>
                                    <option value="'PT Serif', serif">PT Serif</option>                                
                                    <option value="custom">Custom...</option>
                                </select>
                                <input type="text" id="customFontFamily" placeholder="Enter custom font family" style="display: none;">
                            </div>
                        </label>
                        <label for="fontSize">
                            <span>Font Size (px):</span>
                            <input type="number" id="fontSize" value="16" min="1" max="200">
                        </label>
                        <label for="textColor">
                            <span>Font Color:</span>
                            <div class="color-input-wrapper">
                                <input type="color" id="textColor" value="#ffffff">
                            </div>
                        </label>
                    </div>
                    <!-- Bold, Italic, Text Outline Options -->
                    <div class="form-group four-items">
                        <label for="textBold">
                            <span>Bold:</span>
                            <div class="styled-checkbox">
                                <input type="checkbox" id="textBold" checked>
                            </div>
                        </label>
                        <label for="textItalic">
                            <span>Italic:</span>
                            <div class="styled-checkbox">
                                <input type="checkbox" id="textItalic">
                            </div>
                        </label>
                        <label for="textOutline">
                            <span>Text Outline:</span>
                            <div class="styled-checkbox">
                                <input type="checkbox" id="textOutline" checked>
                            </div>
                        </label>
                        <label for="textOutlineColor">
                            <span>Outline Color:</span>
                            <div class="color-input-wrapper">
                                <input type="color" id="textOutlineColor" value="#000000">
                            </div>
                        </label>
                    </div>
                </div>
                <!-- Image Button Controls -->
                <div class="section" id="imageControls">
                    <h2>IMAGE BUTTON</h2>
                    <!-- Image Upload -->
                    <div class="image-upload-section">
                        <label for="imageUpload" class="image-upload-label">Upload Image</label>
                        <input type="file" id="imageUpload" accept="image/*">
                    </div>
                    <!-- Text Subcategory -->
                    <div class="subsection">
                        <h3>Text Settings</h3>
                        <div class="form-group">
                            <label for="imageButtonText" class="form-group label-full-width">
                                <span>Button Text:</span>
                                <input type="text" id="imageButtonText" value="Button Text">
                            </label>
                        </div>
                        <div class="form-group three-items">
                            <label for="showImageText">
                                <span>Show Text</span>
                                <input type="checkbox" id="showImageText" style="margin-top: 10px;">
                            </label>
                            <label for="textOffsetX">
                                <span>Text Offset X (px):</span>
                                <input type="number" id="textOffsetX" value="0" min="-100" max="100">
                            </label>
                            <label for="textOffsetY">
                                <span>Text Offset Y (px):</span>
                                <input type="number" id="textOffsetY" value="0" min="-100" max="100">
                            </label>
                        </div>
                    </div>
                    <!-- Transform Subcategory -->
                    <div class="subsection">
                        <h3>Transform</h3>
                        <!-- Existing Size Controls -->
                        <div class="form-group">
                            <label for="imageHeight">
                                <span>Height (px):</span>
                                <input type="number" id="imageHeight" placeholder="Auto" min="10">
                            </label>
                            <label for="imageWidth">
                                <span>Width (px):</span>
                                <input type="number" id="imageWidth" placeholder="Auto" min="10">
                            </label>
                            <label for="imageResizePercentage">
                                <span>Resize Percentage (%):</span>
                                <input type="number" id="imageResizePercentage" value="100" min="10" max="200">
                            </label>
                        </div>
                        <!-- Flip and Rotate Controls on the Same Row -->
                        <div class="form-group four-items">
                            <label for="rotateLeft">
                                <span>Rotate Left 90°:</span>
                                <button type="button" id="rotateLeft" class="transform-button">⟲</button>
                            </label>
                            <label for="rotateRight">
                                <span>Rotate Right 90°:</span>
                                <button type="button" id="rotateRight" class="transform-button">⟳</button>
                            </label>
                            <label for="flipHorizontal">
                                <span>Flip Horizontally:</span>
                                <button type="button" id="flipHorizontal" class="transform-button">⇋</button>
                            </label>
                            <label for="flipVertical">
                                <span>Flip Vertically:</span>
                                <button type="button" id="flipVertical" class="transform-button">⇅</button>
                            </label>
                        </div>
                    </div>
                    <!-- Effects Controls -->
                    <div class="subsection">
                        <h3>
                            Effects
                            <button id="resetEffects" type="button" class="auto-button">Reset</button>
                        </h3>
                        <!-- Adjustments Subcategory -->
                        <div class="subsection">
                            <h3>Adjustments</h3>
                            <div class="form-group">
                                <label for="imageBrightness">
                                    <span>Brightness (%):</span>
                                    <input type="range" id="imageBrightness" min="0" max="200" value="100">
                                </label>
                                <label for="imageContrast">
                                    <span>Contrast (%):</span>
                                    <input type="range" id="imageContrast" min="0" max="200" value="100">
                                </label>
                                <label for="imageHue">
                                    <span>Hue (°):</span>
                                    <input type="range" id="imageHue" min="0" max="360" value="0">
                                </label>
                                <label for="imageSaturation">
                                    <span>Saturation (%):</span>
                                    <input type="range" id="imageSaturation" min="0" max="200" value="100">
                                </label>
                                <label for="imageOpacity">
                                    <span>Opacity (%):</span>
                                    <input type="range" id="imageOpacity" min="0" max="100" value="100">
                                </label>
                            </div>
                        </div>
                        <!-- Shadow Subcategory -->
                        <div class="subsection">
                            <h3>Shadow</h3>
                            <div class="form-group four-items">
                                <label for="imageShadowEffect">
                                    <span>Enable Shadow:</span>
                                    <div class="styled-checkbox">
                                        <input type="checkbox" id="imageShadowEffect" checked>
                                    </div>
                                </label>
                            </div>
                            <div class="form-group two-items">
                                <label for="imageShadowColor">
                                    <span>Shadow Color:</span>
                                    <div class="color-input-wrapper">
                                        <input type="color" id="imageShadowColor" value="#000000">
                                    </div>
                                </label>
                                <label for="imageShadowBlur">
                                    <span>Shadow Blur (px):</span>
                                    <input type="number" id="imageShadowBlur" value="5" min="0" style="width: 80px;">
                                </label>
                            </div>
                            <div class="form-group two-items">
                                <label for="imageShadowXOffset">
                                    <span>Shadow X Offset (px):</span>
                                    <input type="number" id="imageShadowXOffset" value="2" min="-50" max="50">
                                </label>
                                <label for="imageShadowYOffset">
                                    <span>Shadow Y Offset (px):</span>
                                    <input type="number" id="imageShadowYOffset" value="2" min="-50" max="50">
                                </label>
                            </div>
                        </div>
                        <!-- Filters Subcategory -->
                        <div class="subsection">
                            <h3>Filters</h3>
                            <div class="form-group">
                                <label for="imagePixelate">
                                    <span>Pixelate (px):</span>
                                    <input type="range" id="imagePixelate" min="1" max="20" value="1">
                                </label>
                                <label for="imageNoise">
                                    <span>Noise (%):</span>
                                    <input type="range" id="imageNoise" min="0" max="100" value="0">
                                </label>
                                <label for="imageBlur">
                                    <span>Blur (px):</span>
                                    <input type="range" id="imageBlur" min="0" max="10" value="0">
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- COLOUR Section (Applies to Text Button Only) -->
                <div class="section active" id="colorControls">
                    <h2>COLOUR</h2>
                    <!-- Background Style Dropdown -->
                    <div id="backgroundStyleContainer">
                        <label for="backgroundStyle">
                            <span>Background Style:</span>
                            <select id="backgroundStyle">
                                <option value="solid">Solid</option>
                                <option value="vertical-gradient" selected>Vertical Gradient</option>
                                <option value="horizontal-gradient">Horizontal Gradient</option>
                                <option value="diagonal-gradient">Diagonal Gradient</option>
                                <option value="radial-gradient">Radial Gradient</option>
                            </select>
                        </label>
                    </div>
                    <!-- Original Colors Subsection -->
                    <div class="subsection">
                        <h3>Original</h3>
                        <div class="form-group three-items">
                            <label for="bgColor">
                                <span>Main Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="bgColor" value="#4CAF50"> <!-- Green -->
                                </div>
                            </label>
                            <label for="gradientEndColor">
                                <span>Secondary Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="gradientEndColor" value="#163C1D"> <!-- Dark Green -->
                                </div>
                            </label>
                            <label for="borderColor">
                                <span>Border Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="borderColor" value="#000000"> <!-- Black Border -->
                                </div>
                            </label>
                        </div>
                    </div>
                    <!-- Hover Colors Subsection -->
                    <div class="subsection">
                        <h3>
                            Hover
                            <button id="autoHoverColors" type="button" class="auto-button">Auto</button>
                        </h3>
                        <div class="form-group three-items">
                            <label for="bgColorHover">
                                <span>Main Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="bgColorHover" value="#56d860"> <!-- Bright Green -->
                                </div>
                            </label>
                            <label for="gradientEndColorHover">
                                <span>Secondary Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="gradientEndColorHover" value="#1c4723"> <!-- Darker Green -->
                                </div>
                            </label>
                            <label for="borderColorHover">
                                <span>Border Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="borderColorHover" value="#000000">
                                </div>
                            </label>
                        </div>
                    </div>
                    <!-- Active Colors Subsection -->
                    <div class="subsection">
                        <h3>
                            Active
                            <button id="autoActiveColors" type="button" class="auto-button">Auto</button>
                        </h3>
                        <div class="form-group three-items">
                            <label for="bgColorActive">
                                <span>Main Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="bgColorActive" value="#3a9f40"> <!-- Darker Green -->
                                </div>
                            </label>
                            <label for="gradientEndColorActive">
                                <span>Secondary Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="gradientEndColorActive" value="#122915"> <!-- Even Darker Green -->
                                </div>
                            </label>
                            <label for="borderColorActive">
                                <span>Border Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="borderColorActive" value="#000000">
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
                <!-- BORDER Section (Applies to Text Button Only) -->
                <div class="section active" id="borderControls">
                    <h2>BORDER</h2>
                    <!-- Border Style, Border Width, Corner Radius -->
                    <div class="form-group">
                        <label for="borderStyle">
                            <span>Border Style:</span>
                            <select id="borderStyle">
                                <option value="solid">Solid</option>
                                <option value="double">Double</option>
                                <option value="groove">Groove</option>
                                <option value="ridge">Ridge</option>
                                <option value="inset">Inset</option>
                                <option value="outset" selected>Outset</option>
                                <option value="none">None</option>
                            </select>
                        </label>
                        <label for="borderWidth">
                            <span>Border Width (px):</span>
                            <input type="number" id="borderWidth" value="3" min="0" style="width: 80px;">
                        </label>
                        <label for="cornerRadius">
                            <span>Corner Radius (px):</span>
                            <input type="number" id="cornerRadius" value="8" min="0" max="40">
                        </label>
                    </div>
                </div>
                <!-- SIZE Section (Applies to Text Button Only) -->
                <div class="section active" id="sizeControls">
                    <h2>SIZE</h2>
                    <!-- Width, Height -->
                    <div class="form-group two-items">
                        <label for="width">
                            <span>Width (px):</span>
                            <input type="number" id="width" placeholder="Auto" min="10">
                        </label>
                        <label for="height">
                            <span>Height (px):</span>
                            <input type="number" id="height" placeholder="Auto" min="10">
                        </label>
                    </div>
                    <!-- Padding Top/Bottom, Padding Left/Right -->
                    <div class="form-group two-items">
                        <label for="paddingTB">
                            <span>Padding Top & Bottom (px):</span>
                            <input type="number" id="paddingTB" value="10" min="0">
                        </label>
                        <label for="paddingLR">
                            <span>Padding Left & Right (px):</span>
                            <input type="number" id="paddingLR" value="20" min="0">
                        </label>
                    </div>
                </div>
                <!-- EFFECTS Section (Applies to Text Button Only) -->
                <div class="section active" id="effectsControls">
                    <h2>EFFECTS</h2>
                    <!-- Shadow Subcategory -->
                    <div class="subsection">
                        <h3>Shadow</h3>
                        <div class="form-group four-items">
                            <label for="shadowEffect">
                                <span>Enable Shadow:</span>
                                <div class="styled-checkbox">
                                    <input type="checkbox" id="shadowEffect" checked>
                                </div>
                            </label>
                        </div>
                        <div class="form-group two-items">
                            <label for="shadowColor">
                                <span>Shadow Color:</span>
                                <div class="color-input-wrapper">
                                    <input type="color" id="shadowColor" value="#000000">
                                </div>
                            </label>
                            <label for="shadowBlur">
                                <span>Shadow Blur (px):</span>
                                <input type="number" id="shadowBlur" value="5" min="0" style="width: 80px;">
                            </label>
                        </div>
                        <div class="form-group two-items">
                            <label for="shadowXOffset">
                                <span>Shadow X Offset (px):</span>
                                <input type="number" id="shadowXOffset" value="2" min="-50" max="50">
                            </label>
                            <label for="shadowYOffset">
                                <span>Shadow Y Offset (px):</span>
                                <input type="number" id="shadowYOffset" value="2" min="-50" max="50">
                            </label>
                        </div>
                    </div>
                    <!-- Emboss Subcategory -->
                    <div class="subsection">
                        <h3>Emboss</h3>
                        <div class="form-group four-items">
                            <label for="embossEffect">
                                <span>Enable Emboss:</span>
                                <div class="styled-checkbox">
                                    <input type="checkbox" id="embossEffect">
                                </div>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="embossRadius">
                                <span>Emboss Radius (px):</span>
                                <input type="number" id="embossRadius" value="3" min="0" max="10">
                            </label>
                            <label for="embossIntensity">
                                <span>Emboss Intensity:</span>
                                <input type="number" id="embossIntensity" value="0.5" min="0" max="1" step="0.1">
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Preview Area -->
            <div id="preview">
                <div id="buttonContainer">
                    <!-- Text Button -->
                    <button id="textButton">Click Me</button>
                    <!-- Image Button with Image Text Inside -->
                    <button id="imageButton">
                        <img id="imageButtonImg" src="" alt="Image Button" crossorigin="anonymous">
                        <div id="imageText" class="image-text">Button Text</div>
                    </button>
                </div>
                <div id="downloadButtons">
                    <button id="downloadNormal">Download Normal</button>
                    <button id="downloadHover">Download Hover</button>
                    <button id="downloadActive">Download Active</button>
                </div>
            </div>
        </main>
                <!-- Include html2canvas library -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        <script>
            window.addEventListener('DOMContentLoaded', function() {
                // Define a global variable to track the current active tab
                let currentTab = 'text'; // Default active tab

                // Tab Elements
                const textTab = document.getElementById('textTab');
                const imageTab = document.getElementById('imageTab');
                const textControls = document.getElementById('textControls');
                const imageControls = document.getElementById('imageControls');
                const colorControls = document.getElementById('colorControls');
                const borderControls = document.getElementById('borderControls');
                const sizeControls = document.getElementById('sizeControls');
                const effectsControls = document.getElementById('effectsControls');

                // Button Elements
                const textButton = document.getElementById('textButton');
                const imageButton = document.getElementById('imageButton');
                const imageButtonImg = document.getElementById('imageButtonImg');

                // Image Text Element
                const imageText = document.getElementById('imageText');

                // Download Buttons
                const downloadNormal = document.getElementById('downloadNormal');
                const downloadHover = document.getElementById('downloadHover');
                const downloadActive = document.getElementById('downloadActive');

                // Common Elements
                const dynamicStyles = document.getElementById('dynamicStyles');

                // Text Button Controls
                const buttonText = document.getElementById('buttonText');
                const fontSize = document.getElementById('fontSize');
                const fontFamilySelect = document.getElementById('fontFamily');
                const customFontFamilyInput = document.getElementById('customFontFamily');
                const textColor = document.getElementById('textColor');
                const textBold = document.getElementById('textBold');
                const textItalic = document.getElementById('textItalic');
                const textOutline = document.getElementById('textOutline');
                const textOutlineColor = document.getElementById('textOutlineColor');

                // Color Controls
                const backgroundStyle = document.getElementById('backgroundStyle');
                const bgColor = document.getElementById('bgColor');
                const gradientEndColor = document.getElementById('gradientEndColor');
                const borderColor = document.getElementById('borderColor');
                const bgColorHover = document.getElementById('bgColorHover');
                const gradientEndColorHover = document.getElementById('gradientEndColorHover');
                const borderColorHover = document.getElementById('borderColorHover');
                const bgColorActive = document.getElementById('bgColorActive');
                const gradientEndColorActive = document.getElementById('gradientEndColorActive');
                const borderColorActive = document.getElementById('borderColorActive');

                // Auto Buttons
                const autoHoverColors = document.getElementById('autoHoverColors');
                const autoActiveColors = document.getElementById('autoActiveColors');

                // Border Controls
                const borderStyleSelect = document.getElementById('borderStyle');
                const borderWidth = document.getElementById('borderWidth');
                const cornerRadius = document.getElementById('cornerRadius');

                // Size Controls
                const widthInput = document.getElementById('width');
                const heightInput = document.getElementById('height');
                const paddingTB = document.getElementById('paddingTB');
                const paddingLR = document.getElementById('paddingLR');

                // Effects Controls for Text Button
                const shadowEffect = document.getElementById('shadowEffect');
                const shadowXOffset = document.getElementById('shadowXOffset');
                const shadowYOffset = document.getElementById('shadowYOffset');
                const shadowBlur = document.getElementById('shadowBlur');
                const shadowColor = document.getElementById('shadowColor');
                const embossEffect = document.getElementById('embossEffect');
                const embossRadius = document.getElementById('embossRadius');
                const embossIntensity = document.getElementById('embossIntensity');

                // Image Button Controls
                const imageUpload = document.getElementById('imageUpload');

                // Image Text Controls
                const imageButtonText = document.getElementById('imageButtonText');
                const showImageText = document.getElementById('showImageText');
                const textOffsetX = document.getElementById('textOffsetX');
                const textOffsetY = document.getElementById('textOffsetY');

                // Image Size Controls
                const imageResizePercentage = document.getElementById('imageResizePercentage');
                const imageWidth = document.getElementById('imageWidth');
                const imageHeight = document.getElementById('imageHeight');

                // Effects Controls for Image Button
                // Adjustments Controls
                const imageBrightness = document.getElementById('imageBrightness');
                const imageContrast = document.getElementById('imageContrast');
                const imageHue = document.getElementById('imageHue');
                const imageSaturation = document.getElementById('imageSaturation');
                const imageOpacity = document.getElementById('imageOpacity');
                const imageBlur = document.getElementById('imageBlur');

                // Filters Controls
                const imagePixelate = document.getElementById('imagePixelate');
                const imageNoise = document.getElementById('imageNoise');

                // Shadow Controls
                const imageShadowEffect = document.getElementById('imageShadowEffect');
                const imageShadowXOffset = document.getElementById('imageShadowXOffset');
                const imageShadowYOffset = document.getElementById('imageShadowYOffset');
                const imageShadowBlur = document.getElementById('imageShadowBlur');
                const imageShadowColor = document.getElementById('imageShadowColor');

                // Reset Button
                const resetEffects = document.getElementById('resetEffects');

                // Transformation variables
                let rotationAngle = 0; // in degrees
                let flipHorizontal = 1; // 1 or -1
                let flipVertical = 1; // 1 or -1

                // Variables to store images
                let uploadedImage = null;

                // Switch Tab Function
                function switchTab(activeTab) {
                    if (activeTab === 'text') {
                        // Activate Text Tab
                        textTab.classList.add('active');
                        imageTab.classList.remove('active');
                        // Show Text Controls and related sections
                        textControls.classList.add('active');
                        colorControls.classList.add('active');
                        borderControls.classList.add('active');
                        sizeControls.classList.add('active');
                        effectsControls.classList.add('active');
                        // Hide Image Controls
                        imageControls.classList.remove('active');
                        // Show Text Button, Hide Image Button
                        textButton.style.display = 'inline-block';
                        imageButton.style.display = 'none';
                        // Hide Image Text
                        imageText.style.display = 'none';
                        // Remove image button styles from dynamicStyles
                        removeImageButtonStyles();
                        // Update currentTab
                        currentTab = 'text';
                    } else if (activeTab === 'image') {
                        // Activate Image Tab
                        imageTab.classList.add('active');
                        textTab.classList.remove('active');
                        // Hide Text Controls and related sections
                        textControls.classList.remove('active');
                        colorControls.classList.remove('active');
                        borderControls.classList.remove('active');
                        sizeControls.classList.remove('active');
                        effectsControls.classList.remove('active');
                        // Show Image Controls
                        imageControls.classList.add('active');
                        // Show Image Button only if an image is uploaded
                        imageButton.style.display = uploadedImage ? 'inline-block' : 'none';
                        // Show Image Text if checkbox is checked and image is uploaded
                        imageText.style.display = showImageText.checked && uploadedImage ? 'block' : 'none';
                        // Ensure Text Button is hidden
                        textButton.style.display = 'none';
                        // Remove text button styles from dynamicStyles
                        dynamicStyles.textContent = '';
                        // Update currentTab
                        currentTab = 'image';
                    }
                }

                // Event listeners for tabs
                textTab.addEventListener('click', () => switchTab('text'));
                imageTab.addEventListener('click', () => switchTab('image'));

                // Function to generate background CSS based on state
                function generateBackgroundCSS(mainColor, secondaryColor) {
                    let backgroundValue = '';
                    switch (backgroundStyle.value) {
                        case 'solid':
                            backgroundValue = mainColor;
                            break;
                        case 'vertical-gradient':
                            backgroundValue = `linear-gradient(${mainColor}, ${secondaryColor})`;
                            break;
                        case 'horizontal-gradient':
                            backgroundValue = `linear-gradient(to right, ${mainColor}, ${secondaryColor})`;
                            break;
                        case 'diagonal-gradient':
                            backgroundValue = `linear-gradient(45deg, ${mainColor}, ${secondaryColor})`;
                            break;
                        case 'radial-gradient':
                            backgroundValue = `radial-gradient(circle, ${mainColor}, ${secondaryColor})`;
                            break;
                        default:
                            backgroundValue = mainColor;
                    }
                    return backgroundValue;
                }

                // Function to generate box-shadow CSS
                function generateBoxShadowCSS() {
                    let boxShadowCSS = '';
                    let boxShadows = [];
                    if (shadowEffect && shadowEffect.checked) {
                        const xOffset = shadowXOffset.value;
                        const yOffset = shadowYOffset.value;
                        const blur = shadowBlur.value;
                        const color = shadowColor.value;
                        boxShadows.push(`${xOffset}px ${yOffset}px ${blur}px ${color}`);
                    }
                    if (embossEffect && embossEffect.checked) {
                        const radius = embossRadius.value;
                        let intensity = parseFloat(embossIntensity.value);
                        // Cap intensity at 0.3 to prevent overpowering the background
                        intensity = intensity > 0.3 ? 0.3 : intensity;
                        const highlightColor = `rgba(255,255,255,${intensity})`;
                        const shadowColorEmboss = `rgba(0,0,0,${intensity})`;
                        // Reduce blur radius to 2px
                        const adjustedBlur = parseInt(radius) > 2 ? 2 : parseInt(radius);
                        boxShadows.push(`inset ${radius}px ${radius}px ${adjustedBlur}px ${highlightColor}`);
                        boxShadows.push(`inset -${radius}px -${radius}px ${adjustedBlur}px ${shadowColorEmboss}`);
                    }
                    if (boxShadows.length > 0) {
                        boxShadowCSS = `${boxShadows.join(', ')}`;
                    }
                    return boxShadowCSS;
                }

                // Function to adjust brightness using HSL
                function adjustBrightnessHSL(hex, amount) {
                    const [r, g, b] = hexToRgb(hex);
                    let [h, s, l] = rgbToHsl(r, g, b);
                    l += amount;
                    l = Math.min(Math.max(l, 0), 1); // Clamp between 0 and 1
                    const [newR, newG, newB] = hslToRgb(h, s, l);
                    return rgbToHex(newR, newG, newB);
                }

                // Helper functions to convert hex to RGB and back
                function hexToRgb(hex) {
                    hex = hex.replace(/^#/, '');
                    if (hex.length === 3) {
                        hex = hex.split('').map(x => x + x).join('');
                    }
                    const bigint = parseInt(hex, 16);
                    const r = (bigint >> 16) & 255;
                    const g = (bigint >> 8) & 255;
                    const b = bigint & 255;
                    return [r, g, b];
                }

                function rgbToHex(r, g, b) {
                    return '#' + [r, g, b].map(x => {
                        const hex = x.toString(16);
                        return hex.length === 1 ? '0' + hex : hex;
                    }).join('');
                }

                // Helper functions to convert RGB to HSL and back
                function rgbToHsl(r, g, b) {
                    r /= 255;
                    g /= 255;
                    b /= 255;
                    const max = Math.max(r, g, b);
                    const min = Math.min(r, g, b);
                    let h, s, l = (max + min) / 2;

                    if (max === min) {
                        h = s = 0; // achromatic
                    } else {
                        const d = max - min;
                        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                        switch (max) {
                            case r:
                                h = (g - b) / d + (g < b ? 6 : 0);
                                break;
                            case g:
                                h = (b - r) / d + 2;
                                break;
                            case b:
                                h = (r - g) / d + 4;
                                break;
                        }
                        h /= 6;
                    }

                    return [h, s, l];
                }

                function hslToRgb(h, s, l) {
                    let r, g, b;

                    if (s === 0) {
                        r = g = b = l; // achromatic
                    } else {
                        const hue2rgb = function hue2rgb(p, q, t) {
                            if (t < 0) t += 1;
                            if (t > 1) t -= 1;
                            if (t < 1/6) return p + (q - p) * 6 * t;
                            if (t < 1/2) return q;
                            if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                            return p;
                        };

                        const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                        const p = 2 * l - q;
                        r = hue2rgb(p, q, h + 1/3);
                        g = hue2rgb(p, q, h);
                        b = hue2rgb(p, q, h - 1/3);
                    }

                    return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
                }

                // Auto color functions using HSL for better brightness adjustment
                function setAutoHoverColors() {
                    const brightenAmount = 0.1; // Increase lightness by 10%
                    const mainColor = bgColor.value;
                    const secondaryColor = gradientEndColor.value;

                    const newMainColor = adjustBrightnessHSL(mainColor, brightenAmount);
                    const newSecondaryColor = adjustBrightnessHSL(secondaryColor, brightenAmount);

                    bgColorHover.value = newMainColor;
                    gradientEndColorHover.value = newSecondaryColor;

                    updateDynamicStyles();
                }

                function setAutoActiveColors() {
                    const darkenAmount = -0.15; // Decrease lightness by 15%
                    const mainColor = bgColor.value;
                    const secondaryColor = gradientEndColor.value;

                    const newMainColor = adjustBrightnessHSL(mainColor, darkenAmount);
                    const newSecondaryColor = adjustBrightnessHSL(secondaryColor, darkenAmount);

                    bgColorActive.value = newMainColor;
                    gradientEndColorActive.value = newSecondaryColor;

                    updateDynamicStyles();
                }

                // Function to update styles for Text Button
                function updateTextButtonStyles() {
                    // Input validation
                    fontSize.value = Math.min(Math.max(fontSize.value, 1), 200);
                    cornerRadius.value = Math.min(Math.max(cornerRadius.value, 0), 40);
                    embossRadius.value = Math.min(Math.max(embossRadius.value, 0), 10);
                    embossIntensity.value = Math.min(Math.max(embossIntensity.value, 0), 1);
                
                    // Update button text
                    textButton.textContent = buttonText.value;
                
                    // Determine font family
                    let selectedFont = fontFamilySelect.value;
                    if (selectedFont === 'custom') {
                        selectedFont = customFontFamilyInput.value.trim() !== '' ? customFontFamilyInput.value : 'Arial, sans-serif';
                    }
                
                    // Original State Background and Border
                    const originalBackgroundValue = generateBackgroundCSS(bgColor.value, gradientEndColor.value);
                    const originalBorderColor = borderColor.value;
                
                    // Hover State Background and Border
                    const hoverBackgroundValue = generateBackgroundCSS(bgColorHover.value, gradientEndColorHover.value);
                    const hoverBorderColor = borderColorHover.value;
                
                    // Active State Background and Border
                    const activeBackgroundValue = generateBackgroundCSS(bgColorActive.value, gradientEndColorActive.value);
                    const activeBorderColor = borderColorActive.value;
                
                    // Generate box-shadow CSS
                    const boxShadowCSS = generateBoxShadowCSS();
                
                    // Determine font weight and style
                    const fontWeight = textBold.checked ? 'bold' : 'normal';
                    const fontStyle = textItalic.checked ? 'italic' : 'normal';
                
                    // Build CSS for Text Button with higher specificity
                    let css = '';
                    css += '#preview #buttonContainer #textButton {\n'; // Increased specificity
                    css += `  font-size: ${fontSize.value}px;\n`;
                    css += `  font-family: ${selectedFont};\n`;
                    css += `  color: ${textColor.value};\n`;
                    css += `  font-weight: ${fontWeight};\n`;
                    css += `  font-style: ${fontStyle};\n`;
                    css += `  ${textOutline.checked ? `text-shadow: -1px -1px 0 ${textOutlineColor.value}, 1px -1px 0 ${textOutlineColor.value}, -1px 1px 0 ${textOutlineColor.value}, 1px 1px 0 ${textOutlineColor.value};` : 'text-shadow: none;'}\n`;
                    css += `  background: ${originalBackgroundValue};\n`;
                    css += `  border-width: ${borderWidth.value}px;\n`;
                    css += `  border-style: ${borderStyleSelect.value};\n`;
                    css += `  border-color: ${originalBorderColor};\n`;
                    css += `  border-radius: ${cornerRadius.value}px;\n`;
                    css += `  padding: ${paddingTB.value}px ${paddingLR.value}px;\n`;
                    css += `  cursor: pointer;\n`;
                    if (widthInput.value) {
                        css += `  width: ${widthInput.value}px;\n`;
                    } else {
                        css += `  width: auto;\n`;
                    }
                    if (heightInput.value) {
                        css += `  height: ${heightInput.value}px;\n`;
                        css += `  line-height: ${heightInput.value}px;\n`;
                    } else {
                        css += `  height: auto;\n`;
                    }
                    css += `  box-shadow: ${boxShadowCSS};\n`;
                    css += '  transition: all 0.3s ease;\n';
                    css += '}\n';
                
                    // Hover State for Text Button with higher specificity
                    css += '#preview #buttonContainer #textButton:hover {\n'; // Increased specificity
                    css += `  background: ${hoverBackgroundValue};\n`;
                    css += `  border-color: ${hoverBorderColor};\n`;
                    css += '}\n';
                
                    // Active State for Text Button with higher specificity
                    css += '#preview #buttonContainer #textButton:active {\n'; // Increased specificity
                    css += `  background: ${activeBackgroundValue};\n`;
                    css += `  border-color: ${activeBorderColor};\n`;
                    css += '}\n';
                
                    // Apply CSS
                    dynamicStyles.textContent = css;
                
                    // Debugging
                    console.log('Dynamic Styles Updated for Text Button:', css);
                }

                // Function to update styles for Image Button
                function updateImageButtonStyles() {
                    if (uploadedImage) {
                        // Apply CSS Filters
                        const brightness = imageBrightness.value;
                        const contrast = imageContrast.value;
                        const hue = imageHue.value;
                        const saturation = imageSaturation.value;
                        const opacity = imageOpacity.value;
                        const blur = imageBlur.value;

                        let filterCSS = `
                            brightness(${brightness}%)
                            contrast(${contrast}%)
                            hue-rotate(${hue}deg)
                            saturate(${saturation}%)
                            opacity(${opacity}%)
                            blur(${blur}px)
                        `.replace(/\s+/g, ' ').trim();

                        // Apply Shadow Effect if enabled
                        if (imageShadowEffect && imageShadowEffect.checked) {
                            const xOffset = imageShadowXOffset.value;
                            const yOffset = imageShadowYOffset.value;
                            const shadowBlurVal = imageShadowBlur.value;
                            const color = imageShadowColor.value;
                            filterCSS += ` drop-shadow(${xOffset}px ${yOffset}px ${shadowBlurVal}px ${color})`;
                        }

                        // Apply Pixelate Filter if value > 1
                        const pixelateValue = parseInt(imagePixelate.value);
                        if (pixelateValue > 1) {
                            // Update the scale based on pixelateValue
                            const scaleDown = 1 / pixelateValue;
                            const scaleUp = pixelateValue;

                            // Dynamically update the pixelate filter's scale
                            const pixelateFilter = document.getElementById('pixelateFilter');
                            if (pixelateFilter) {
                                const feScaleDown = pixelateFilter.querySelector('feScale:first-of-type');
                                const feScaleUp = pixelateFilter.querySelector('feScale:last-of-type');
                                if (feScaleDown && feScaleUp) {
                                    feScaleDown.setAttribute('scale', scaleDown.toString());
                                    feScaleUp.setAttribute('scale', scaleUp.toString());
                                }
                            }

                            filterCSS += ` url(#pixelateFilter)`;
                        }

                        // Apply Noise Filter if value > 0
                        const noiseValue = parseInt(imageNoise.value);
                        if (noiseValue > 0) {
                            // Update the noise filter's baseFrequency based on noiseValue
                            const noiseFilter = document.getElementById('noiseFilter');
                            if (noiseFilter) {
                                const feTurbulence = noiseFilter.querySelector('feTurbulence');
                                if (feTurbulence) {
                                    // Adjust baseFrequency based on noiseValue
                                    // Normalize noiseValue (0-100) to baseFrequency (0.1-1)
                                    const baseFrequency = (noiseValue / 100) * 0.9 + 0.1;
                                    feTurbulence.setAttribute('baseFrequency', baseFrequency.toString());
                                }
                            }

                            filterCSS += ` url(#noiseFilter)`;
                        }

                        // Apply Transformations
                        const resizePercentage = parseInt(imageResizePercentage.value) || 100;
                        const transform = `scale(${flipHorizontal * (resizePercentage / 100)}, ${flipVertical * (resizePercentage / 100)}) rotate(${rotationAngle}deg)`;

                        // Apply manual size if specified
                        if (imageWidth.value) {
                            imageButton.style.width = `${imageWidth.value}px`;
                        } else {
                            imageButton.style.width = 'auto';
                        }
                        if (imageHeight.value) {
                            imageButton.style.height = `${imageHeight.value}px`;
                        } else {
                            imageButton.style.height = 'auto';
                        }

                        // Build CSS for Image Button with higher specificity
                        let css = '';
                        css += '#preview #buttonContainer #imageButton {\n'; // Increased specificity
                        css += `  filter: ${filterCSS};\n`;
                        css += `  transform: ${transform};\n`;
                        css += '  transition: all 0.3s ease;\n';
                        css += '}\n';

                        // Hover State (Increase Brightness by 10%)
                        css += '#preview #buttonContainer #imageButton:hover {\n'; // Increased specificity
                        const hoverBrightness = Math.min(parseFloat(imageBrightness.value) * 1.1, 200); // Cap at 200%
                        let hoverFilterCSS = `
                            brightness(${hoverBrightness}%)
                            contrast(${contrast}%)
                            hue-rotate(${hue}deg)
                            saturate(${saturation}%)
                            opacity(${opacity}%)
                            blur(${blur}px)
                        `.replace(/\s+/g, ' ').trim();
                        if (imageShadowEffect && imageShadowEffect.checked) {
                            hoverFilterCSS += ` drop-shadow(${imageShadowXOffset.value}px ${imageShadowYOffset.value}px ${imageShadowBlur.value}px ${imageShadowColor.value})`;
                        }
                        if (pixelateValue > 1) {
                            hoverFilterCSS += ` url(#pixelateFilter)`;
                        }
                        if (noiseValue > 0) {
                            hoverFilterCSS += ` url(#noiseFilter)`;
                        }
                        css += `  filter: ${hoverFilterCSS};\n`;
                        css += '}\n';

                        // Active State (Decrease Brightness by 15%)
                        css += '#preview #buttonContainer #imageButton:active {\n'; // Increased specificity
                        const activeBrightness = Math.max(parseFloat(imageBrightness.value) * 0.85, 0); // Floor at 0%
                        let activeFilterCSS = `
                            brightness(${activeBrightness}%)
                            contrast(${contrast}%)
                            hue-rotate(${hue}deg)
                            saturate(${saturation}%)
                            opacity(${opacity}%)
                            blur(${blur}px)
                        `.replace(/\s+/g, ' ').trim();
                        if (imageShadowEffect && imageShadowEffect.checked) {
                            activeFilterCSS += ` drop-shadow(${imageShadowXOffset.value}px ${imageShadowYOffset.value}px ${imageShadowBlur.value}px ${imageShadowColor.value})`;
                        }
                        if (pixelateValue > 1) {
                            activeFilterCSS += ` url(#pixelateFilter)`;
                        }
                        if (noiseValue > 0) {
                            activeFilterCSS += ` url(#noiseFilter)`;
                        }
                        css += `  filter: ${activeFilterCSS};\n`;
                        css += '}\n';

                        // Apply CSS
                        dynamicStyles.textContent = css;

                        // Handle Image Text
                        if (showImageText.checked) {
                            imageText.style.display = 'block';
                            imageText.textContent = imageButtonText.value;
                            applyImageTextStyles(imageText);
                            const offsetX = parseInt(textOffsetX.value) || 0;
                            const offsetY = parseInt(textOffsetY.value) || 0;
                            imageText.style.transform = `translate(-50%, -50%) translate(${offsetX}px, ${offsetY}px)`;
                        } else {
                            imageText.style.display = 'none';
                        }

                        // Debugging
                        console.log('Dynamic Styles Updated for Image Button:', css);
                    }
                }

                // Helper function to copy computed styles to an element
                function copyComputedStyles(sourceElement, targetElement) {
                    const computedStyle = window.getComputedStyle(sourceElement);
                    for (let property of computedStyle) {
                        targetElement.style.setProperty(
                            property,
                            computedStyle.getPropertyValue(property),
                            computedStyle.getPropertyPriority(property)
                        );
                    }
                }

                // Function to remove image button specific styles from dynamicStyles
                function removeImageButtonStyles() {
                    // Remove all styles related to #imageButton and #imageButtonImg from dynamicStyles
                    const styles = dynamicStyles.textContent.split('\n');
                    const filteredStyles = styles.filter(line => 
                        !line.includes('#imageButton') && 
                        !line.includes('#imageButtonImg') &&
                        !line.includes('#imageText')
                    );
                    dynamicStyles.textContent = filteredStyles.join('\n');
                }

                // Function to download the button image
                function downloadDataUrl(filename, dataUrl) {
                    const link = document.createElement('a');
                    link.download = filename;
                    link.href = dataUrl;
                    link.target = '_blank';
                    document.body.appendChild(link);

                    // For Firefox, dispatch a click event
                    if (document.createEvent) {
                        const event = document.createEvent('MouseEvents');
                        event.initEvent('click', true, true);
                        link.dispatchEvent(event);
                    } else {
                        link.click();
                    }

                    document.body.removeChild(link);
                }

                // Helper function to apply styles to the cloned Text Button based on state
                function applyCloneTextButtonStyles(clone, state) {
                    // Apply common styles
                    clone.style.fontSize = `${fontSize.value}px`;
                    clone.style.fontFamily = fontFamilySelect.value === 'custom' ? (customFontFamilyInput.value.trim() !== '' ? customFontFamilyInput.value : 'Arial, sans-serif') : fontFamilySelect.value;
                    clone.style.color = textColor.value;
                    clone.style.fontWeight = textBold.checked ? 'bold' : 'normal';
                    clone.style.fontStyle = textItalic.checked ? 'italic' : 'normal';
                    clone.style.textShadow = textOutline.checked ? `-1px -1px 0 ${textOutlineColor.value}, 1px -1px 0 ${textOutlineColor.value}, -1px 1px 0 ${textOutlineColor.value}, 1px 1px 0 ${textOutlineColor.value}` : 'none';
                    clone.style.borderWidth = `${borderWidth.value}px`;
                    clone.style.borderStyle = borderStyleSelect.value;
                    clone.style.borderRadius = `${cornerRadius.value}px`;
                    clone.style.padding = `${paddingTB.value}px ${paddingLR.value}px`;
                    clone.style.cursor = 'pointer';
                    // Remove the following line to retain box-shadow
                    // clone.style.boxShadow = 'none'; // Remove box-shadow
                    clone.style.transition = 'all 0.3s ease';
                    clone.style.display = 'inline-block';

                    // Width and Height
                    if (widthInput.value) {
                        clone.style.width = `${widthInput.value}px`;
                    } else {
                        clone.style.width = 'auto';
                    }
                    if (heightInput.value) {
                        clone.style.height = `${heightInput.value}px`;
                        clone.style.lineHeight = `${heightInput.value}px`;
                    } else {
                        clone.style.height = 'auto';
                    }

                    // Background and border-color based on state
                    switch(state) {
                        case 'normal':
                            clone.style.background = generateBackgroundCSS(bgColor.value, gradientEndColor.value);
                            clone.style.borderColor = borderColor.value;
                            break;
                        case 'hover':
                            clone.style.background = generateBackgroundCSS(bgColorHover.value, gradientEndColorHover.value);
                            clone.style.borderColor = borderColorHover.value;
                            break;
                        case 'active':
                            clone.style.background = generateBackgroundCSS(bgColorActive.value, gradientEndColorActive.value);
                            clone.style.borderColor = borderColorActive.value;
                            break;
                    }

                    // Apply box-shadow based on current settings
                    if (shadowEffect.checked || embossEffect.checked) {
                        clone.style.boxShadow = generateBoxShadowCSS();
                    } else {
                        clone.style.boxShadow = 'none';
                    }

                    console.log(`Applied ${state} styles to Text Button Clone.`);
                }

                function applyCloneImageButtonStyles(clone, state) {
                    // Reset any existing filters and transformations
                    clone.style.filter = 'none';
                    clone.style.transform = 'none';
                
                    // Define filter and transform based on state
                    if (state === 'hover') {
                        const hoverBrightness = Math.min(parseFloat(imageBrightness.value) * 1.1, 200); // Increase brightness by 10%
                        clone.style.filter = `
                            brightness(${hoverBrightness}%)
                            contrast(${imageContrast.value}%)
                            hue-rotate(${imageHue.value}deg)
                            saturate(${imageSaturation.value}%)
                            opacity(${imageOpacity.value}%)
                            blur(${imageBlur.value}px)
                            ${imageShadowEffect.checked ? `drop-shadow(${imageShadowXOffset.value}px ${imageShadowYOffset.value}px ${imageShadowBlur.value}px ${imageShadowColor.value})` : ''}
                        `.replace(/\s+/g, ' ').trim();
                    } else if (state === 'active') {
                        const activeBrightness = Math.max(parseFloat(imageBrightness.value) * 0.85, 0); // Decrease brightness by 15%
                        clone.style.filter = `
                            brightness(${activeBrightness}%)
                            contrast(${imageContrast.value}%)
                            hue-rotate(${imageHue.value}deg)
                            saturate(${imageSaturation.value}%)
                            opacity(${imageOpacity.value}%)
                            blur(${imageBlur.value}px)
                            ${imageShadowEffect.checked ? `drop-shadow(${imageShadowXOffset.value}px ${imageShadowYOffset.value}px ${imageShadowBlur.value}px ${imageShadowColor.value})` : ''}
                        `.replace(/\s+/g, ' ').trim();
                    } else if (state === 'normal') {
                        clone.style.filter = `
                            brightness(${imageBrightness.value}%)
                            contrast(${imageContrast.value}%)
                            hue-rotate(${imageHue.value}deg)
                            saturate(${imageSaturation.value}%)
                            opacity(${imageOpacity.value}%)
                            blur(${imageBlur.value}px)
                            ${imageShadowEffect.checked ? `drop-shadow(${imageShadowXOffset.value}px ${imageShadowYOffset.value}px ${imageShadowBlur.value}px ${imageShadowColor.value})` : ''}
                        `.replace(/\s+/g, ' ').trim();
                    }
                
                    // Apply transformations (flip and rotate)
                    const resizePercentage = parseInt(imageResizePercentage.value) || 100;
                    clone.style.transform = `scale(${flipHorizontal * (resizePercentage / 100)}, ${flipVertical * (resizePercentage / 100)}) rotate(${rotationAngle}deg)`;
                }
                // Helper function to apply styles to the cloned Image Text
                function applyImageTextStyles(textClone) {
                    // Reset styles
                    textClone.style = '';
            
                    // Apply common styles
                    textClone.style.position = 'absolute';
                    textClone.style.color = '#ecf0f1';
                    textClone.style.fontSize = '18px';
                    textClone.style.pointerEvents = 'none';
                    textClone.style.textShadow = `
                        -1px -1px 0 #000,
                        1px -1px 0 #000,
                        -1px 1px 0 #000,
                        1px 1px 0 #000
                    `;
                    textClone.style.transition = 'all 0.3s ease';
                    textClone.style.display = 'block';
                    textClone.style.top = '50%';
                    textClone.style.left = '50%';
                    textClone.style.transform = 'translate(-50%, -50%)';
                    textClone.style.whiteSpace = 'nowrap';
                }

                // Function to handle image upload
                function handleImageUpload(event) {
                    const file = event.target.files[0];
                    if (file && file.type.startsWith('image/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = new Image();
                            img.crossOrigin = 'Anonymous'; // To avoid CORS issues
                            img.onload = function() {
                                // Set the image source
                                imageButtonImg.src = e.target.result;
                                uploadedImage = img;
                                // Update styles
                                if (currentTab === 'image') { // Use currentTab instead of activeTab
                                    // Show Image Button only if an image is uploaded
                                    imageButton.style.display = uploadedImage ? 'inline-block' : 'none';
                                    // Show Image Text if checkbox is checked
                                    imageText.style.display = showImageText.checked && uploadedImage ? 'block' : 'none';
                                } else {
                                    imageButton.style.display = 'none';
                                    imageText.style.display = 'none';
                                }
                                // Update image button styles
                                updateImageButtonStyles();
                            }
                            img.src = e.target.result;
                        }
                        reader.readAsDataURL(file);
                    }
                }

                // Function to reset effects to default values
                function resetEffectsToDefault() {
                    // Reset all effect controls to default values
                    imageBrightness.value = 100;
                    imageContrast.value = 100;
                    imageHue.value = 0;
                    imageSaturation.value = 100;
                    imageOpacity.value = 100;
                    imageBlur.value = 0;
                    imagePixelate.value = 1;
                    imageNoise.value = 0;
                    imageShadowEffect.checked = false;
                    imageShadowXOffset.value = 2;
                    imageShadowYOffset.value = 2;
                    imageShadowBlur.value = 5;
                    imageShadowColor.value = '#000000'; /* Updated to match border color */

                    // Reset transformation variables
                    rotationAngle = 0;
                    flipHorizontal = 1;
                    flipVertical = 1;

                    // Update the image
                    updateImageButtonStyles();

                    textOffsetX.value = 0;
                    textOffsetY.value = 0;
                    if (imageText) {
                        imageText.style.transform = `translate(-50%, -50%) translate(0px, 0px)`;
                    }
                    imageText.textContent = imageButtonText.value;
                }

                // Function to update styles for both Text Button and Image Button
                function updateDynamicStyles() {
                    if (currentTab === 'text') {
                        updateTextButtonStyles();
                    } else if (currentTab === 'image') {
                        updateImageButtonStyles();
                    }
                }

                // Function to handle font family input visibility
                function handleFontFamilyChange() {
                    if (fontFamilySelect.value === 'custom') {
                        customFontFamilyInput.style.display = 'block';
                    } else {
                        customFontFamilyInput.style.display = 'none';
                    }
                }

                // Event listeners for Text Button controls

                // Select all input elements within controls
                const textInputElements = document.querySelectorAll(
                    '#textControls input, #colorControls input, #borderControls input, #sizeControls input, #effectsControls input'
                );

                // Select all select elements within controls
                const textSelectElements = document.querySelectorAll(
                    '#textControls select, #colorControls select, #borderControls select, #sizeControls select, #effectsControls select'
                );

                // Attach 'input' event listeners to input elements
                textInputElements.forEach(input => {
                    input.addEventListener('input', updateDynamicStyles);
                });

                // Attach 'change' event listeners to select elements
                textSelectElements.forEach(select => {
                    select.addEventListener('change', updateDynamicStyles);
                });

                // Event listener for font family select
                fontFamilySelect.addEventListener('change', () => {
                    handleFontFamilyChange();
                    updateDynamicStyles();
                });

                // Event listeners for auto buttons
                autoHoverColors.addEventListener('click', setAutoHoverColors);
                autoActiveColors.addEventListener('click', setAutoActiveColors);

                // Event listeners for download buttons
                downloadNormal.addEventListener('click', () => downloadButtonImage('normal'));
                downloadHover.addEventListener('click', () => downloadButtonImage('hover'));
                downloadActive.addEventListener('click', () => downloadButtonImage('active'));

                // Event listener for image upload
                imageUpload.addEventListener('change', handleImageUpload);

                // Event listener to update text button text
                buttonText.addEventListener('input', () => {
                    textButton.textContent = buttonText.value;
                });

                // Event listener to update image button text
                imageButtonText.addEventListener('input', () => {
                    imageText.textContent = imageButtonText.value;
                    if (showImageText.checked && uploadedImage) {
                        imageText.style.display = 'block';
                    }
                });

                // Event listener for Show Text checkbox
                showImageText.addEventListener('change', () => {
                    imageText.style.display = showImageText.checked && uploadedImage ? 'block' : 'none';
                });

                // Event listeners for transform buttons
                const rotateLeftButton = document.getElementById('rotateLeft');
                const rotateRightButton = document.getElementById('rotateRight');
                const flipHorizontalButton = document.getElementById('flipHorizontal');
                const flipVerticalButton = document.getElementById('flipVertical');

                rotateLeftButton.addEventListener('click', () => {
                    rotationAngle = (rotationAngle - 90) % 360;
                    updateImageButtonStyles();
                });

                rotateRightButton.addEventListener('click', () => {
                    rotationAngle = (rotationAngle + 90) % 360;
                    updateImageButtonStyles();
                });

                flipHorizontalButton.addEventListener('click', () => {
                    flipHorizontal *= -1;
                    updateImageButtonStyles();
                });

                flipVerticalButton.addEventListener('click', () => {
                    flipVertical *= -1;
                    updateImageButtonStyles();
                });

                // Attach 'input' event listeners to input elements
                textInputElements.forEach(input => {
                    input.addEventListener('input', updateDynamicStyles);
                });

                // Ensure imagePixelate and imageNoise are included
                imagePixelate.addEventListener('input', updateDynamicStyles);
                imageNoise.addEventListener('input', updateDynamicStyles);


                // Event listeners for Adjustments and Filters
                imageBrightness.addEventListener('input', updateImageButtonStyles);
                imageContrast.addEventListener('input', updateImageButtonStyles);
                imageHue.addEventListener('input', updateImageButtonStyles);
                imageSaturation.addEventListener('input', updateImageButtonStyles);
                imageOpacity.addEventListener('input', updateImageButtonStyles);
                imageBlur.addEventListener('input', updateImageButtonStyles);
                imagePixelate.addEventListener('input', updateImageButtonStyles);
                imageNoise.addEventListener('input', updateImageButtonStyles);

                // Event listener for Reset button
                resetEffects.addEventListener('click', resetEffectsToDefault);

                // Initial setup
                imageText.style.display = 'none'; // Hide image text by default
                setAutoHoverColors(); // Set default hover colors
                setAutoActiveColors(); // Set default active colors
                handleFontFamilyChange();
                updateDynamicStyles();

                // Function to download the button image
                function downloadButtonImage(state) {
                    // Determine which tab is active
                    if (currentTab === 'text') {
                        // Handle Text Button Download
                        downloadTextButton(state);
                    } else if (currentTab === 'image' && uploadedImage) {
                        // Handle Image Button Download
                        downloadImageButton(state);
                    } else {
                        alert('Please select a valid button to download.');
                    }
                }

                // Function to download Text Button
                function downloadTextButton(state) {
                    // Clone the textButton
                    const clone = textButton.cloneNode(true);

                    // Remove any existing inline styles to prevent conflicts
                    clone.removeAttribute('style');

                    // Apply computed styles to clone
                    copyComputedStyles(textButton, clone);

                    // Apply state-specific styles
                    applyCloneTextButtonStyles(clone, state);

                    // Create a temporary container for capturing
                    const tempContainer = document.createElement('div');
                    tempContainer.style.display = 'inline-block';
                    tempContainer.style.margin = '0';
                    tempContainer.style.padding = '0';
                    tempContainer.style.border = 'none';
                    tempContainer.style.background = 'none';

                    // Position the container off-screen to avoid affecting layout
                    tempContainer.style.position = 'fixed';
                    tempContainer.style.top = '-10000px';
                    tempContainer.style.left = '-10000px';

                    tempContainer.appendChild(clone);
                    document.body.appendChild(tempContainer);

                    // Use html2canvas to capture the button as PNG with transparent background and increased scale
                    html2canvas(clone, {
                        useCORS: true,
                        allowTaint: false,
                        backgroundColor: null, // Make background transparent
                        scale: 3 // Increase scale for better resolution
                    })
                        .then(function (canvas) {
                            const dataUrl = canvas.toDataURL('image/png');
                            downloadDataUrl(`text-button-${state}.png`, dataUrl);
                            document.body.removeChild(tempContainer);
                        })
                        .catch(function (error) {
                            console.error('An error occurred while capturing the Text Button:', error);
                            document.body.removeChild(tempContainer);
                        });
                }

                // Function to download Image Button
                function downloadImageButton(state) {
                    // Clone the imageButton
                    const clone = imageButton.cloneNode(true);

                    // Remove any existing inline styles to prevent conflicts
                    clone.removeAttribute('style');

                    // Apply computed styles to clone
                    copyComputedStyles(imageButton, clone);

                    // Apply state-specific styles
                    applyCloneImageButtonStyles(clone, state);

                    // Handle Image Text if applicable
                    const textClone = clone.querySelector('.image-text');
                    if (showImageText.checked && uploadedImage) {
                        textClone.textContent = imageButtonText.value;
                        // Apply text offsets
                        const offsetX = parseInt(textOffsetX.value) || 0;
                        const offsetY = parseInt(textOffsetY.value) || 0;
                        textClone.style.transform = `translate(-50%, -50%) translate(${offsetX}px, ${offsetY}px)`;
                    } else {
                        if (textClone) {
                            textClone.style.display = 'none';
                        }
                    }

                    // Create a temporary container for capturing
                    const tempContainer = document.createElement('div');
                    tempContainer.style.display = 'inline-block';
                    tempContainer.style.margin = '0';
                    tempContainer.style.padding = '0';
                    tempContainer.style.border = 'none';
                    tempContainer.style.background = 'none';

                    // Position the container off-screen to avoid affecting layout
                    tempContainer.style.position = 'fixed';
                    tempContainer.style.top = '-10000px';
                    tempContainer.style.left = '-10000px';

                    tempContainer.appendChild(clone);
                    document.body.appendChild(tempContainer);

                    // Use html2canvas to capture the button as PNG with transparent background and increased scale
                    html2canvas(clone, {
                        useCORS: true,
                        allowTaint: false,
                        backgroundColor: null, // Make background transparent
                        scale: 3 // Increase scale for better resolution
                    })
                        .then(function (canvas) {
                            const dataUrl = canvas.toDataURL('image/png');
                            downloadDataUrl(`image-button-${state}.png`, dataUrl);
                            document.body.removeChild(tempContainer);
                        })
                        .catch(function (error) {
                            console.error('An error occurred while capturing the Image Button:', error);
                            document.body.removeChild(tempContainer);
                        });
                }

            });
        </script>
    
    </body>
    </html>
    