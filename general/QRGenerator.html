<!--╔══════════════════════════════════════════════════════════════════════════════════════════╗
    ║                                Name: UnitConverter Pro                                   ║
    ║                                Author: Carson Morris                                    ║
    ║                                   Date: 11/20/2024                                      ║
    ║                                      Rev: 3.1                                           ║
    ╚══════════════════════════════════════════════════════════════════════════════════════════╝-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Unit Converter Pro</title>
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
          integrity="sha512-pf1QYhZBRU4Caxljw2E1KaQe7bVz+E6B9uC2r5VDTP6zTyrZkW9F+19KTpoTpPpVfAPjz7hH5cBqyk4PU8s5cQ==" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Base Styles */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298, #2980b9, #6dd5ed);
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 50px 20px;
            animation: fadeIn 1.5s ease-in-out;
            min-height: 100vh;
            position: relative;
            transition: background 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Dark Mode Styles */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50, #34495e, #4a69bd, #55aefc);
            color: #ecf0f1;
        }

        header {
            background: linear-gradient(145deg, #34495e, #2c3e50);
            color: #f1c40f;
            padding: 20px 30px;
            text-align: center;
            border-radius: 12px;
            width: 100%;
            max-width: 1200px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        header h1 {
            font-size: 2.5rem;
            color: #f39c12;
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
            margin: 0;
        }
        .credit {
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-style: italic;
        }
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 30px;
            cursor: pointer;
            color: #f1c40f;
            font-size: 1.5rem;
            transition: color 0.3s;
        }
        .theme-toggle:hover {
            color: #e67e22;
        }

        /* Main Layout */
        main {
            display: flex;
            flex-direction: column;
            gap: 30px;
            width: 100%;
            max-width: 1200px;
            margin-top: 30px;
            background: linear-gradient(145deg, #34495e, #2c3e50);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            padding: 30px;
            transition: background 0.5s ease;
        }

        /* Measurement Categories Grid */
        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            justify-items: center;
            margin-bottom: 20px;
        }
        .categories-grid button {
            background: #2c3e50;
            border: 1px solid #34495e;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 12px;
            width: 100%;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s, color 0.3s;
            font-weight: 500;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            height: 120px;
        }
        .categories-grid button.active, .categories-grid button:hover {
            background: #f1c40f;
            color: #34495e;
            transform: translateY(-2px);
        }
        .categories-grid button i {
            margin-bottom: 8px;
            font-size: 1.5rem;
        }

        /* Form & Input Styling */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        label {
            font-size: 1.1rem;
            color: #f1c40f;
            font-weight: 500;
        }
        input[type="number"], select {
            width: 100%;
            padding: 12px 15px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.3s, box-shadow 0.3s;
        }
        input[type="number"]:focus, select:focus {
            background-color: #34495e;
            box-shadow: inset 0 0 5px #f39c12;
            outline: none;
        }
        .converter {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .converter > div {
            flex: 1;
            min-width: 220px;
        }
        .input-group {
            position: relative;
        }
        .input-group .unit-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #f1c40f;
            pointer-events: none;
        }

        /* Action Buttons */
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, box-shadow 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 120px;
            justify-content: center;
        }
        .btn-primary {
            background-color: #f1c40f;
            color: #34495e;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }
        .btn-primary:hover {
            background-color: #e67e22;
            transform: translateY(-2px);
        }
        .btn-clear {
            background-color: #e74c3c;
            color: #ecf0f1;
        }
        .btn-clear:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }
        .btn-save-favorite {
            background-color: #f39c12;
            color: #ecf0f1;
        }
        .btn-save-favorite:hover {
            background-color: #d35400;
            transform: translateY(-2px);
        }

        /* Result Area */
        #result {
            padding: 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            min-height: 80px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            overflow-y: auto;
            transition: background-color 0.3s;
        }
        #result .converted-value {
            background-color: rgba(46, 204, 113, 0.3);
            padding: 4px 6px;
            border-radius: 4px;
        }

        /* Explanation Area */
        #explanation {
            padding: 20px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            min-height: 80px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            overflow-y: auto;
            transition: background-color 0.3s;
        }

        /* Pattern Library */
        #patternLibrary {
            padding: 20px;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            max-height: 350px;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        #patternLibrary ul {
            list-style: none;
            padding-left: 0;
        }
        #patternLibrary li {
            padding: 10px;
            border-bottom: 1px solid #34495e;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        #patternLibrary li:hover {
            background-color: #34495e;
            transform: translateX(5px);
        }
        #patternLibrary li:last-child {
            border-bottom: none;
        }
        #patternLibrary li .pattern-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }
        #patternLibrary li .pattern-info span {
            font-size: 0.9rem;
            color: #bdc3c7;
        }

        /* History Log */
        #historyLog {
            padding: 20px;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        #historyLog ul {
            list-style: none;
            padding-left: 0;
        }
        #historyLog li {
            padding: 8px 0;
            border-bottom: 1px solid #34495e;
            font-size: 0.95rem;
        }
        #historyLog li:last-child {
            border-bottom: none;
        }

        /* Favorites */
        #favorites {
            padding: 20px;
            border: none;
            border-radius: 8px;
            background-color: #2c3e50;
            color: #ecf0f1;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
            transition: background-color 0.3s;
        }
        #favorites ul {
            list-style: none;
            padding-left: 0;
        }
        #favorites li {
            padding: 8px 0;
            border-bottom: 1px solid #34495e;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        #favorites li:last-child {
            border-bottom: none;
        }
        #favorites li .favorite-actions {
            display: flex;
            gap: 10px;
        }
        #favorites li .favorite-actions i {
            cursor: pointer;
            transition: color 0.3s;
        }
        #favorites li .favorite-actions i:hover {
            color: #e67e22;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            main {
                max-width: 1000px;
            }
        }
        @media (max-width: 768px) {
            .converter {
                flex-direction: column;
                align-items: stretch;
            }
            .buttons {
                flex-direction: column;
                align-items: stretch;
            }
            .btn {
                width: 100%;
                justify-content: center;
            }
            #patternLibrary, #historyLog, #favorites {
                max-height: 250px;
            }
            .categories-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
        @media (max-width: 480px) {
            header h1 {
                font-size: 2rem;
            }
            .pattern-info span {
                display: none;
            }
            .categories-grid button {
                height: 100px;
            }
        }
    </style>
</head>
<body>
    <header>
        <a href="../index.html" style="position: absolute; left: 30px; text-decoration: none; color: #f1c40f;">
            <i class="fas fa-home" style="font-size: 1.8rem;"></i>
        </a>
        <h1>Unit Converter Pro</h1>
        <div class="credit">Created by: Carson Morris</div>
        <div class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">
            <i class="fas fa-moon"></i>
        </div>
    </header>

    <main>
        <!-- Measurement Categories Grid -->
        <div class="section-title">Select Measurement Category</div>
        <div class="categories-grid">
            <button data-category="length" class="active" title="Length">
                <i class="fas fa-ruler-horizontal"></i>
                Length
            </button>
            <button data-category="mass" title="Mass">
                <i class="fas fa-weight-hanging"></i>
                Mass
            </button>
            <button data-category="time" title="Time">
                <i class="fas fa-clock"></i>
                Time
            </button>
            <button data-category="temperature" title="Temperature">
                <i class="fas fa-temperature-high"></i>
                Temperature
            </button>
            <button data-category="volume" title="Volume">
                <i class="fas fa-water"></i>
                Volume
            </button>
            <button data-category="area" title="Area">
                <i class="fas fa-vector-square"></i>
                Area
            </button>
            <button data-category="speed" title="Speed">
                <i class="fas fa-tachometer-alt"></i>
                Speed
            </button>
            <button data-category="energy" title="Energy">
                <i class="fas fa-bolt"></i>
                Energy
            </button>
            <button data-category="power" title="Power">
                <i class="fas fa-fire"></i>
                Power
            </button>
            <button data-category="pressure" title="Pressure">
                <i class="fas fa-tachometer-alt"></i>
                Pressure
            </button>
            <button data-category="data" title="Data Storage">
                <i class="fas fa-database"></i>
                Data
            </button>
            <button data-category="finance" title="Finance">
                <i class="fas fa-dollar-sign"></i>
                Finance
            </button>
            <button data-category="cryptocurrency" title="Cryptocurrency">
                <i class="fab fa-bitcoin"></i>
                Crypto
            </button>
            <button data-category="astronomy" title="Astronomy">
                <i class="fas fa-meteor"></i>
                Astronomy
            </button>
            <!-- Add more categories as needed -->
        </div>

        <!-- Converter Section -->
        <div class="converter">
            <div class="form-group">
                <label for="inputValue">Input Value:</label>
                <div class="input-group">
                    <input type="number" id="inputValue" placeholder="Enter value to convert" oninput="runConversion()" aria-label="Input Value">
                    <i class="fas fa-calculator unit-icon"></i>
                </div>
            </div>
            
            <div class="form-group">
                <label for="fromUnit">From:</label>
                <select id="fromUnit" onchange="runConversion()" aria-label="From Unit">
                    <!-- Units will be populated dynamically -->
                </select>
            </div>
            
            <div class="form-group">
                <label for="toUnit">To:</label>
                <select id="toUnit" onchange="runConversion()" aria-label="To Unit">
                    <!-- Units will be populated dynamically -->
                </select>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="buttons">
            <button class="btn btn-primary" onclick="runConversion()"><i class="fas fa-play"></i> Convert</button>
            <button class="btn btn-clear" onclick="clearFields()"><i class="fas fa-times"></i> Clear</button>
            <button class="btn btn-save-favorite" onclick="saveFavorite()"><i class="fas fa-star"></i> Save Favorite</button>
        </div>

        <!-- Result Area -->
        <div id="result">
            <strong>Result:</strong>
            <p id="output">No conversion yet. Enter a value and select units.</p>
        </div>

        <!-- Explanation Area -->
        <div id="explanation">
            <strong>Conversion Explanation:</strong>
            <p>Enter a value and select units to see the conversion details.</p>
        </div>

        <!-- Pattern Library -->
        <div id="patternLibrary">
            <strong>Common Conversions:</strong>
            <ul id="patternsList">
                <li onclick="selectConversion('length', 'meter', 'kilometer')">
                    <span>Meter to Kilometer</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('mass', 'kilogram', 'pound')">
                    <span>Kilogram to Pound</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('time', 'hour', 'minute')">
                    <span>Hour to Minute</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('temperature', 'celsius', 'fahrenheit')">
                    <span>Celsius to Fahrenheit</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('volume', 'liter', 'gallon')">
                    <span>Liter to Gallon</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('speed', 'meter_per_second', 'kilometer_per_hour')">
                    <span>m/s to km/h</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('data', 'gigabyte', 'terabyte')">
                    <span>Gigabyte to Terabyte</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('finance', 'usd', 'eur')">
                    <span>USD to EUR</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('cryptocurrency', 'bitcoin', 'ethereum')">
                    <span>Bitcoin to Ethereum</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <li onclick="selectConversion('astronomy', 'light_year', 'astronomical_unit')">
                    <span>Light Year to AU</span>
                    <i class="fas fa-exchange-alt"></i>
                </li>
                <!-- Add more patterns as needed -->
            </ul>
        </div>

        <!-- Conversion History -->
        <div id="historyLog">
            <strong>Conversion History:</strong>
            <ul id="historyList">
                <!-- History items will appear here -->
            </ul>
        </div>

        <!-- Favorites -->
        <div id="favorites">
            <strong>Favorites:</strong>
            <ul id="favoritesList">
                <!-- Favorite conversions will appear here -->
            </ul>
        </div>
    </main>

    <script>
        // Unit definitions
        const units = {
            length: {
                meter: 1,
                kilometer: 1000,
                centimeter: 0.01,
                millimeter: 0.001,
                mile: 1609.34,
                yard: 0.9144,
                foot: 0.3048,
                inch: 0.0254,
                nautical_mile: 1852
            },
            mass: {
                kilogram: 1,
                gram: 0.001,
                milligram: 0.000001,
                pound: 0.453592,
                ounce: 0.0283495,
                ton: 907.185
            },
            time: {
                second: 1,
                minute: 60,
                hour: 3600,
                day: 86400,
                week: 604800,
                month: 2629800, // Approximate
                year: 31557600 // Approximate
            },
            temperature: {
                celsius: 'celsius',
                fahrenheit: 'fahrenheit',
                kelvin: 'kelvin'
            },
            volume: {
                liter: 1,
                milliliter: 0.001,
                cubic_meter: 1000,
                gallon: 3.78541,
                quart: 0.946353,
                pint: 0.473176,
                cup: 0.24,
                ounce_fluid: 0.0295735
            },
            area: {
                square_meter: 1,
                square_kilometer: 1e6,
                square_centimeter: 0.0001,
                hectare: 10000,
                acre: 4046.86,
                square_mile: 2589988.11,
                square_yard: 0.836127,
                square_foot: 0.092903,
                square_inch: 0.00064516
            },
            speed: {
                meter_per_second: 1,
                kilometer_per_hour: 0.277778,
                mile_per_hour: 0.44704,
                knot: 0.514444,
                foot_per_second: 0.3048
            },
            energy: {
                joule: 1,
                kilojoule: 1000,
                calorie: 4.184,
                kilocalorie: 4184,
                watt_hour: 3600,
                kilowatt_hour: 3.6e6,
                british_thermal_unit: 1055.06
            },
            power: {
                watt: 1,
                kilowatt: 1000,
                horsepower: 745.7,
                megawatt: 1e6
            },
            pressure: {
                pascal: 1,
                kilopascal: 1000,
                bar: 100000,
                atmosphere: 101325,
                psi: 6894.76,
                torr: 133.322
            },
            data: {
                bit: 1,
                byte: 8,
                kilobit: 1000,
                kilobyte: 8000,
                megabit: 1e6,
                megabyte: 8e6,
                gigabit: 1e9,
                gigabyte: 8e9,
                terabit: 1e12,
                terabyte: 8e12
            },
            finance: {
                usd: 1,
                eur: 0.85,
                gbp: 0.75,
                jpy: 110.0,
                aud: 1.35,
                cad: 1.25,
                chf: 0.92,
                cny: 6.47,
                inr: 74.0,
                rub: 73.0
            },
            cryptocurrency: {
                bitcoin: 1,
                ethereum: 15, // Example ratio: 1 BTC = 15 ETH
                litecoin: 200,
                ripple: 5000,
                dogecoin: 30000,
                cardano: 45000,
                polkadot: 150,
                solana: 200
            },
            astronomy: {
                light_year: 9.461e+15, // meters
                astronomical_unit: 1.496e+11, // meters
                parsec: 3.086e+16, // meters
                lunar_distance: 3.844e+8, // meters
                gigalight_year: 9.461e+24, // meters
                megaparsec: 3.086e+22 // meters
            }
            // Add more categories and units as needed
        };

        // History and Favorites
        let history = [];
        let favorites = [];

        // Temperature conversion functions
        function convertTemperature(value, from, to) {
            let tempInCelsius;

            // Convert from the source unit to Celsius
            if (from === 'celsius') {
                tempInCelsius = value;
            } else if (from === 'fahrenheit') {
                tempInCelsius = (value - 32) * 5/9;
            } else if (from === 'kelvin') {
                tempInCelsius = value - 273.15;
            }

            // Convert from Celsius to the target unit
            if (to === 'celsius') {
                return tempInCelsius;
            } else if (to === 'fahrenheit') {
                return (tempInCelsius * 9/5) + 32;
            } else if (to === 'kelvin') {
                return tempInCelsius + 273.15;
            }
        }

        // Currency conversion using predefined rates (placeholder implementation)
        async function convertCurrency(value, from, to) {
            // For a real implementation, integrate with a currency conversion API
            // Here, we'll use predefined rates from the units.finance object
            if (!units.finance[from] || !units.finance[to]) return null;
            const rate = units.finance[to] / units.finance[from];
            return value * rate;
        }

        // Cryptocurrency conversion (placeholder implementation)
        function convertCryptocurrency(value, from, to) {
            if (!units.cryptocurrency[from] || !units.cryptocurrency[to]) return null;
            const rate = units.cryptocurrency[to] / units.cryptocurrency[from];
            return value * rate;
        }

        // Initialize units on page load
        window.onload = function() {
            updateUnits('length'); // Default category
            loadHistory();
            loadFavorites();
        };

        // Function to update unit options based on selected category
        function updateUnits(category) {
            const fromUnit = document.getElementById('fromUnit');
            const toUnit = document.getElementById('toUnit');

            // Clear existing options
            fromUnit.innerHTML = '';
            toUnit.innerHTML = '';

            const categoryUnits = units[category];
            for (let unit in categoryUnits) {
                let option = document.createElement('option');
                option.value = unit;
                option.text = capitalizeFirstLetter(unit.replace('_', ' '));
                fromUnit.appendChild(option.cloneNode(true));
                toUnit.appendChild(option.cloneNode(true));
            }

            runConversion();
        }

        // Function to capitalize first letter
        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1).replace(/_/g, ' ');
        }

        // Function to run the conversion
        async function runConversion() {
            const activeButton = document.querySelector('.categories-grid button.active');
            if (!activeButton) return; // No active category selected
            const category = activeButton.getAttribute('data-category');
            const inputValue = parseFloat(document.getElementById('inputValue').value);
            const from = document.getElementById('fromUnit').value;
            const to = document.getElementById('toUnit').value;
            const output = document.getElementById('output');
            const explanation = document.getElementById('explanation');

            if (isNaN(inputValue)) {
                output.innerHTML = `<span style="color: #e74c3c; font-weight: bold;">Please enter a valid number.</span>`;
                explanation.innerHTML = 'Enter a numeric value to perform the conversion.';
                return;
            }

            let result;
            let details = '';

            try {
                if (category === 'temperature') {
                    result = convertTemperature(inputValue, from, to);
                    details = `${inputValue}°${capitalizeFirstLetter(from)} is equal to ${result.toFixed(2)}°${capitalizeFirstLetter(to)}.`;
                } else if (category === 'finance') {
                    result = await convertCurrency(inputValue, from, to);
                    if (result === null) throw new Error('Unsupported currency.');
                    details = `${inputValue} ${from.toUpperCase()} is equal to ${result.toFixed(2)} ${to.toUpperCase()}.`;
                } else if (category === 'cryptocurrency') {
                    result = convertCryptocurrency(inputValue, from, to);
                    if (result === null) throw new Error('Unsupported cryptocurrency.');
                    details = `${inputValue} ${capitalizeFirstLetter(from)} is equal to ${result.toFixed(6)} ${capitalizeFirstLetter(to)}.`;
                } else if (category === 'astronomy') {
                    // Convert astronomy units to meters first
                    const fromFactor = units[category][from];
                    const toFactor = units[category][to];
                    result = (inputValue * fromFactor) / toFactor;
                    details = `${inputValue} ${capitalizeFirstLetter(from.replace('_', ' '))} is equal to ${result.toExponential(3)} ${capitalizeFirstLetter(to.replace('_', ' '))}.`;
                } else {
                    const fromFactor = units[category][from];
                    const toFactor = units[category][to];
                    result = (inputValue * fromFactor) / toFactor;
                    details = `${inputValue} ${from.replace('_', ' ')} is equal to ${result.toFixed(6)} ${to.replace('_', ' ')}.`;
                }

                output.innerHTML = `<span class="converted-value">${result.toLocaleString()}</span>`;
                explanation.innerHTML = details;
                addToHistory(`${inputValue} ${from} → ${result.toLocaleString()} ${to}`);
            } catch (e) {
                output.innerHTML = `<span style="color: #e74c3c; font-weight: bold;">${e.message}</span>`;
                explanation.innerHTML = 'An error occurred during conversion.';
            }
        }

        // Function to clear all fields
        function clearFields() {
            document.getElementById('inputValue').value = '';
            document.getElementById('output').innerHTML = 'No conversion yet. Enter a value and select units.';
            document.getElementById('explanation').innerHTML = 'Enter a value and select units to see the conversion details.';
            runConversion();
        }

        // Function to select a common conversion pattern
        function selectConversion(category, from, to) {
            // Deactivate all category buttons
            document.querySelectorAll('.categories-grid button').forEach(btn => btn.classList.remove('active'));
            // Activate the selected category button
            const selectedButton = document.querySelector(`.categories-grid button[data-category="${category}"]`);
            if (selectedButton) selectedButton.classList.add('active');
            // Update units
            updateUnits(category);
            // Set from and to units
            document.getElementById('fromUnit').value = from;
            document.getElementById('toUnit').value = to;
            // Run conversion
            runConversion();
        }

        // Function to capitalize and format unit names
        function formatUnitName(unit) {
            return capitalizeFirstLetter(unit.replace('_', ' '));
        }

        // Function to save a favorite conversion
        function saveFavorite() {
            const activeButton = document.querySelector('.categories-grid button.active');
            if (!activeButton) return;
            const category = activeButton.getAttribute('data-category');
            const from = document.getElementById('fromUnit').value;
            const to = document.getElementById('toUnit').value;

            const favorite = { category, from, to };
            // Check for duplicates
            if (!favorites.some(fav => fav.category === category && fav.from === from && fav.to === to)) {
                favorites.push(favorite);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                loadFavorites();
                alert('Favorite conversion saved!');
            } else {
                alert('This conversion is already in your favorites.');
            }
        }

        // Function to load history from localStorage
        function loadHistory() {
            const storedHistory = JSON.parse(localStorage.getItem('history')) || [];
            history = storedHistory;
            renderHistory();
        }

        // Function to add to history
        function addToHistory(entry) {
            history.unshift(entry);
            if (history.length > 10) history.pop(); // Limit history to 10 entries
            localStorage.setItem('history', JSON.stringify(history));
            renderHistory();
        }

        // Function to render history
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            history.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                historyList.appendChild(li);
            });
        }

        // Function to load favorites from localStorage
        function loadFavorites() {
            const storedFavorites = JSON.parse(localStorage.getItem('favorites')) || [];
            favorites = storedFavorites;
            renderFavorites();
        }

        // Function to render favorites
        function renderFavorites() {
            const favoritesList = document.getElementById('favoritesList');
            favoritesList.innerHTML = '';
            favorites.forEach((fav, index) => {
                const li = document.createElement('li');

                const infoDiv = document.createElement('div');
                infoDiv.classList.add('pattern-info');
                infoDiv.innerHTML = `<span>${formatUnitName(fav.from)} → ${formatUnitName(fav.to)}</span>
                                     <span>Category: ${capitalizeFirstLetter(fav.category)}</span>`;

                const actionsDiv = document.createElement('div');
                actionsDiv.classList.add('favorite-actions');
                const runBtn = document.createElement('i');
                runBtn.classList.add('fas', 'fa-play');
                runBtn.title = 'Run Conversion';
                runBtn.style.marginRight = '8px';
                runBtn.onclick = () => selectConversion(fav.category, fav.from, fav.to);
                const deleteBtn = document.createElement('i');
                deleteBtn.classList.add('fas', 'fa-trash-alt');
                deleteBtn.title = 'Remove Favorite';
                deleteBtn.onclick = () => removeFavorite(index);
                actionsDiv.appendChild(runBtn);
                actionsDiv.appendChild(deleteBtn);

                li.appendChild(infoDiv);
                li.appendChild(actionsDiv);
                favoritesList.appendChild(li);
            });
        }

        // Function to remove a favorite
        function removeFavorite(index) {
            if (confirm('Are you sure you want to remove this favorite?')) {
                favorites.splice(index, 1);
                localStorage.setItem('favorites', JSON.stringify(favorites));
                renderFavorites();
            }
        }

        // Function to toggle dark mode
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const themeIcon = document.querySelector('.theme-toggle i');
            if (document.body.classList.contains('dark-mode')) {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
        }

        // Function to select a favorite conversion
        function selectFavorite(category, from, to) {
            document.querySelectorAll('.categories-grid button').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-category') === category) btn.classList.add('active');
            });
            updateUnits(category);
            document.getElementById('fromUnit').value = from;
            document.getElementById('toUnit').value = to;
            runConversion();
        }

        // Event Listeners for Measurement Categories Grid
        document.querySelectorAll('.categories-grid button').forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons
                document.querySelectorAll('.categories-grid button').forEach(btn => btn.classList.remove('active'));
                // Add active class to the clicked button
                button.classList.add('active');
                // Update units based on selected category
                const category = button.getAttribute('data-category');
                updateUnits(category);
                // Run conversion
                runConversion();
            });
        });
    </script>
</body>
</html>
